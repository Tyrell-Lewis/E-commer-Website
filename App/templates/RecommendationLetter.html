                            <!DOCTYPE html>
                            <html lang="en">
                            <head>
                                <meta charset="UTF-8">
                                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                                <title>Student Conduct Tracker - Recommendation Letter</title>
                              <link rel="icon" href="https://github.com/RichardR963/Info3604_Project/blob/main/images/AV2.png?raw=true" type="image/png">

                                <style>
                                    body {
                                        margin: 0;
                                        padding: 0;
                                        font-family: Arial, sans-serif;
                                        background: #fff;
                                    }

                                    header {
                                        display: flex;
                                        justify-content: space-between;
                                        align-items: center;
                                        position: fixed;
                                        top: 0;
                                        width: 100%;
                                        z-index: 999;
                                        background: #fff;
                                    }

                                    .logo {
                                        background-color:#051d3c;
                                        border-bottom-right-radius: 50px;
                                        border-top-right-radius: 50px;
                                        padding: 10px 20px;
                                        padding-left: 50px;
                                        font-family: "Titan One", sans-serif;
                                        font-weight: bold;
                                    }

                                    .logo h1 {
                                        margin: 0;
                                        color: white;
                                        font-size: 30px;
                                    }

                                    .nav-bar {
                                        list-style: none;
                                        display: flex;
                                        padding: 10px 20px;
                                        background-color: #051d3c;
                                        border-bottom-left-radius: 40px;
                                        border-top-left-radius: 40px;
                                        font-family: "Titan One", sans-serif;
                                        font-weight: bold;
                                    }

                                    .nav-bar li {
                                        padding: 0 20px;
                                    }

                                    .nav-bar li a {
                                        text-decoration: none;
                                        color: white;
                                    }

                                    .logo2 {
                                        position: absolute;
                                        left: 140px;
                                        color: #051d3c;
                                    }

                                    .recommendation-section {
                                        display: flex;
                                        justify-content: center;
                                        align-items: center;
                                        padding-top: 100px;
                                        margin-bottom: 50px;
                                    }

                                    .recommendation-text {
                                        font-size: 42px;
                                        margin-left: 20px;
                                        transform-origin: center;
                                        background: -webkit-linear-gradient(#084f71, #051d3c);
                                        background: linear-gradient(#084f71, #051d3c);
                                        -webkit-background-clip: text;
                                        background-clip: text;
                                        color: transparent;
                                        -webkit-text-fill-color: transparent;
                                        color: #0056b3;
                                        font-family: "Titan One", sans-serif;
                                    }

                                    .recommendation-image {
                                        height: 120px;
                                        width: 120px;
                                    }

                                  .help {
                                      position: fixed;
                                      bottom: 42%;
                                      right: 50px;
                                      width: 400px; 
                                      z-index: 999;
                                      background-color: rgba(255, 255, 255, 0.8);
                                      padding: 10px;
                                      border-radius: 5px;
                                      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
                                  }

                                    .dropdown1 {
                                        position: fixed;
                                        bottom: -95%;
                                        right: -15px;
                                        transform: translateY(-50%);
                                        text-align: center;
                                        z-index: 999;
                                    }

                                  .dropdown2 {
                                      position: fixed;
                                      bottom: -135%;
                                      right: -15px;
                                      transform: translateY(-50%);
                                      text-align: center;
                                      z-index: 998;
                                  }

                                    .dropdown1 span,.dropdown2 span {
                                        background-color: #051d3c;
                                        color: white;
                                        padding: 10px 20px;
                                        border-radius: 5px;
                                        cursor: pointer;
                                        display: inline-block;
                                        width: 400px;
                                    }



                                    .dropdown-content {
                                        display: none;
                                        position: absolute;
                                        background-color: #f9f9f9;
                                        width: 450px;
                                        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
                                        z-index: 1;
                                        left: 50%;
                                        transform: translateX(-50%);
                                        border: 1px solid #051d3c;
                                        border-radius: 5px;
                                        padding: 10px;
                                        max-height: 200px;
                                        overflow-y: auto;
                                    }

                                    .dropdown-content a {
                                        color: black;
                                        padding: 8px 16px;
                                        text-decoration: none;
                                        display: block;
                                    }

                                    .dropdown-content a:hover {
                                        background-color: #ddd;
                                        border-radius: 5px;
                                    }

                                    .dropdown-content a.selected {
                                        color: green;
                                        font-weight: bold;
                                    }

                                  .dropdown1:hover .dropdown-content,.dropdown2:hover .dropdown-content {
                                      display: block;
                                  }


                                    .button-container {
                                        position: fixed;
                                        top: 50%;
                                        left: 50%;
                                        transform: translate(-50%, -50%);
                                        text-align: center;
                                    }

                                    .button {
                                        background-color: #051d3c;
                                        color: white;
                                        padding: 10px 20px;
                                        border-radius: 5px;
                                        cursor: pointer;
                                        display: block;
                                        width: 200px;
                                        text-align: center;
                                        margin: 0 auto;
                                        margin-bottom: 5px;
                                    }

                                    .button:hover {
                                        background-color: #084f71;
                                    }

                                    .container {
                                        display: flex;
                                        justify-content: left;
                                        align-items: center;
                                        height: calc(100vh - 500px);
                                        margin-left: 40px;
                                      margin-top: 100px;
                                    }

                                    .card {
                                        width: 65%;
                                        background-color: #f9f9f9;
                                        border-radius: 10px;
                                        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
                                        padding: 20px;
                                    }

                                    #userInput {
                                        width: 100%;
                                        height: 500px;
                                        font-size: 20px;
                                        font-family: Arial, sans-serif;
                                        padding: 10px;
                                        box-sizing: border-box;
                                        resize: none;
                                    }

                                  .job-card {
                                    width: 400px;
                                    position: fixed;
                                    top: 35%;
                                    right: 50px;
                                    transform: translateY(-50%);
                                    text-align: center;
                                    z-index: 999;
                                      border: 2px solid #051d3c;
                                      border-radius: 5px;
                                  }

                                  .up-card {
                                    width: 400px;
                                    position: fixed;
                                    top: 290%;
                                    right: 10px;
                                    transform: translateY(-50%);
                                    text-align: center;
                                    z-index: 997;
                                      border: 2px solid #051d3c;
                                      border-radius: 5px;
                                      margin: 5px auto; /* Center the card */
                                  }
                                </style>
                            </head>
                            <body>
                                <header>
                                    <div class="logo">
                                      <h1>UWI</h1>
                                    </div>
                                    <div class="logo2"><h2>Student Conduct Tracker</h2></div>
                                    <ul class="nav-bar">
                                      <li><a href="/staffhome">Home</a></li>
                                      <li><a href="/logout">Logout</a></li>
                                    </ul>
                                </header>

                                <div class="recommendation-section">
                                    <img src="https://github.com/RichardR963/Info3604_Project/blob/main/images/proposed.png?raw=true" alt="Recommendation Icon" class="recommendation-image">
                                    <div class="recommendation-text">Student Recommendation Letter!</div>
                                    <img src="https://github.com/RichardR963/Info3604_Project/blob/main/images/proposed.png?raw=true" alt="Recommendation Icon" class="recommendation-image">
                                </div>

                                <div class="container">
                                    <div class="card">
                                        <textarea id="userInput" placeholder="Enter your text">
                          
                                I am writing this letter of reference to {{student.fullname}} whom I have known for the last year as a student in our {{student.degree}} program. Being a lecturer COMP 2604 Operating Systems course, I found her/him to be a good learner, sincere and a good communicator. She/He is an exceptional student who has consistently demonstrated outstanding academic performance. Her/His dedication to her/his studies is truly commendable, as evidenced by her/his exemplary grades and her/his regular attendance in class. She/He is diligent in taking notes during lectures, ensuring that she/he captures key concepts and ideas effectively.
                            
                                I am confident that {{student.fullname}} has the academic prowess, motivation, and determination to excel in her/his chosen field of study at the postgraduate level. Her/His drive for excellence, coupled with her/his exceptional work ethic and passion for learning, make her/him an ideal candidate for further academic pursuits.
                            
                                I wholeheartedly strongly support {{student.fullname}}'s aspirations to study abroad, and I am certain that she/he will be a valuable asset to any academic institution fortunate enough to have her/him as a student.
                            
                                Please do not hesitate to contact me if you require any further information regarding {{student.fullname}} or her/his academic achievements.

                                        </textarea>
                                    </div>
                                </div>

                              <p class="help">* Click an item from the dropdown to copy and paste into text area as you wish.</p>

                              {% if recommendation.recommendation_type == "jobRecommendation" %}
                              <div class="job-card">  
                                  <div class="job-info">

                                      <p>Company: {{recommendation.company}}</p>
                                        <p>Position : {{recommendation.position}}</p> 
                                          <p>Company Email: {{recommendation.companyEmail}}</p>
                                          <p>Student Reasoning: {{recommendation.details}}</p>
                                      <div>
                              </div>   
                              {% endif %}
                              {% if recommendation.recommendation_type == "schoolRecommendation" %}
                              <div class="job-card">  
                                  <div class="job-info">

                                      <p>School: {{recommendation.school}}</p>
                                        <p>Program : {{recommendation.program}}</p> 
                                          <p>School Email: {{recommendation.schoolEmail}}</p>
                                          <p>Student Reasoning: {{recommendation.details}}</p>
                                      <div>
                              </div> 
                              {% endif %}
                              <div class="dropdown1">
                                  <span>Reviews</span>
                                  <div class="dropdown-content">
                                    {% if student.reviews %}
                                        {% for review in student.reviews %}
                                            <a href="#" data-value="{{ review.details }}">{{ review.details }}</a>
                                        {% endfor %}
                                    {% else %}
                                        <p>No Reviews for this Student</p>
                                    {% endif %}
                                  </div>
                              </div>

                                    <div class="dropdown2">
                                        <span>Achievements</span>
                                        <div class="dropdown-content">
                                            {% if accomplishments %}
                                                {% for accomplishment in accomplishments %}
                                                        <a href="#" data-value="{{ accomplishment.details }}">{{ accomplishment.details }}</a>
                                                {% endfor %}
                                            {% else %}
                                                <p>No Achievements for this Student</p>
                                            {% endif %}
                                        </div>
                                    </div>

                                    <div class="up-card">  
                                        <div class="job-info">

                                          <p>Insert Signature</p>
                                          <input type="file" id="uploadImage" accept="image/*" class="button"> <br>

                                        <button id="convertToPDFButton" class="button" type="button" onclick="sendSignature()">Convert to PDF</button>


                                          <form method="GET" action="/confirmRL/{{recommendation.ID}}">
                                              <button id="confirmButton" class="button" href="/confirmRL/{{recommendation.ID}}">Done</button>
                                          </form>
                                            <div>
                                    </div> 

                                <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.5/jspdf.debug.js"></script>
                                <script>
                                  // Function to copy text to clipboard
                                  function copyToClipboard(text) {
                                      // Create a temporary textarea element
                                      var textarea = document.createElement('textarea');
                                      textarea.value = text;

                                      // Append the textarea to the body
                                      document.body.appendChild(textarea);

                                      // Select the textarea content
                                      textarea.select();

                                      // Copy the selected text to the clipboard
                                      document.execCommand('copy');

                                      // Remove the temporary textarea
                                      document.body.removeChild(textarea);
                                  }

                                  // Function to handle dropdown item click
                                  function handleDropdownItemClick(event) {
                                      // Get the clicked item's text content
                                      var itemText = event.target.textContent.trim();

                                      // Copy the item's text content to the clipboard
                                      copyToClipboard(itemText);

                                      // Optionally, provide visual feedback to the user
                                      alert('Copied to clipboard: ' + itemText);
                                  }

                                  // Add event listeners to dropdown items
                                  var dropdownItems = document.querySelectorAll('.dropdown-content a');
                                  dropdownItems.forEach(function(item) {
                                      item.addEventListener('click', handleDropdownItemClick);
                                  });

                                    function sendSignature() {
                                        var fileInput = document.getElementById('uploadImage');
                                        var file = fileInput.files[0];

                                        var reader = new FileReader();
                                        reader.onload = function(event) {
                                            var base64Image = event.target.result;
                                            // Send the base64Image to your Flask app via an HTTP request
                                            sendBase64ToFlask(base64Image);
                                        };
                                        reader.readAsDataURL(file);
                                    }

                                    function sendBase64ToFlask(base64Image) {
                                        const recommendationID = "{{ recommendation.ID }}"
                                        const studentName = "{{student.firstname+student.lastname}}"
                                        const pdfURL = `/makepdf/${recommendationID}`
                                        var existingText = document.getElementById('userInput').value;
                                        const formData = new FormData();
                                        formData.append('signature', base64Image);
                                        formData.append('details', existingText)

                                        // Send POST request with FormData
                                        fetch(pdfURL, {
                                            method: 'POST',
                                            body: formData
                                        })
                                        .then(response => response.blob())
                                        .then(blob => {
                                            // Create a blob URL for the PDF
                                            const pdfBlob = new Blob([blob], { type: 'application/pdf' });
                                            const pdfURL = URL.createObjectURL(pdfBlob);

                                            // Create a link element to trigger the download
                                            const a = document.createElement('a');
                                            a.href = pdfURL;
                                            a.download = `${studentName} Recommendation.pdf`;
                                            document.body.appendChild(a);
                                            a.click();

                                            // Clean up
                                            URL.revokeObjectURL(pdfURL);
                                            document.body.removeChild(a);
                                        })
                                        .catch(error => console.error('Error:', error));
                                    }


                                </script>
                            </body>
                            </html>
